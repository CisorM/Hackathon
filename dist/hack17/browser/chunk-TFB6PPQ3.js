import{a as U}from"./chunk-BOAM24EX.js";import{b as o}from"./chunk-FYQRXYID.js";import{a as L}from"./chunk-QH7CS6OP.js";import{c as N}from"./chunk-R7DZLFCY.js";import{C as z,D as A,i as V,j as Q,n as j,r as F}from"./chunk-7LRRDA6O.js";import{$ as x,Eb as f,Fb as O,Mb as M,Na as m,Oa as C,Pb as R,Q as E,V as P,a as p,b as u,db as S,fb as d,ia as g,ja as h,jb as c,k as I,kb as s,mb as D,n as q,nb as k,pb as T,ra as y,tb as l,ub as _}from"./chunk-LJKVXSQR.js";var H=(()=>{class i{constructor(e){this.http=e,this.medicationSchema=o.object({id:o.number().int().positive(),name:o.string().min(1,{message:"El nombre del medicamento es obligatorio."}),quantity:o.number().int().nonnegative().refine(t=>t>0,{message:"La cantidad debe ser un n\xFAmero positivo."})}),this.treatmentSchema=o.object({id:o.number().optional(),patient_id:o.number().int().positive(),patientName:o.string().optional(),observation:o.string().min(1,{message:"La observaci\xF3n es obligatoria."}),status:o.enum(["not supplied","partially supplied","supplied"]).optional(),active:o.enum(["active","inactive","deleted"]).optional(),medications:o.array(this.medicationSchema).nonempty({message:"Debe haber al menos un medicamento."}).optional(),createdAt:o.date().optional(),updatedAt:o.date().optional()}),this.apiURL=`${z.apiUrl}treatment`,this.treatment=new I({patient_id:0,patientName:"",observation:"",medications:[]}),this.data=this.treatment.asObservable()}updateTreatment(e){this.treatment.next(e)}updatePatient(e,t){let n=u(p({},this.treatment.getValue()),{patient_id:e,patientName:t});this.updateTreatment(n)}updateObservation(e){let t=this.treatment.getValue(),n=u(p({},t),{observation:e});this.updateTreatment(n)}addMedication(e,t,n){let a=this.treatment.getValue(),r=a.medications.findIndex(b=>b.id===e),w;if(r!==-1){let b=a.medications[r];b.quantity+=n,w=[...a.medications.slice(0,r),b,...a.medications.slice(r+1)]}else w=[...a.medications,{id:e,name:t,quantity:n}];let Z=u(p({},a),{medications:w});this.updateTreatment(Z)}removeMedication(e){let t=this.treatment.getValue(),n=t.medications.filter(r=>r.id!==e),a=u(p({},t),{medications:n});this.updateTreatment(a)}increaseMedicationQuantity(e){let t=this.treatment.getValue(),n=t.medications.map(r=>r.id===e?u(p({},r),{quantity:r.quantity+1}):r),a=u(p({},t),{medications:n});this.updateTreatment(a)}decreaseMedicationQuantity(e){let t=this.treatment.getValue(),n=t.medications.map(r=>r.id===e?u(p({},r),{quantity:Math.max(r.quantity-1,0)}):r),a=u(p({},t),{medications:n});this.updateTreatment(a)}getTreatment(){return this.data}validateTreatment(e){try{return this.treatmentSchema.parse(e),{success:!0}}catch(t){return t instanceof o.ZodError?(console.error("Error de validaci\xF3n:",t.errors),{success:!1,messages:t.errors.map(a=>a.message)}):(console.error("Error inesperado:",t),{success:!1,messages:["Ocurri\xF3 un error inesperado"]})}}saveTreatment(){let e=this.treatment.getValue(),t=this.validateTreatment(e);if(!t.success)return q({success:!1,messages:t.messages});let{headerPost:n}=A(),a={patient_id:e.patient_id,observation:e.observation,medications:e.medications.map(r=>({medication_id:r.id,quantity:r.quantity}))};return console.log(a),this.http.post(`${this.apiURL}/create`,a,{headers:n})}static{this.\u0275fac=function(t){return new(t||i)(P(F))}}static{this.\u0275prov=E({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var B=(()=>{class i{constructor(){this.medicineDeleted=new y,this.quantityIncreased=new y,this.quantityDecreased=new y}deleteMedicine(){this.medicineDeleted.emit(this.medicine.id)}decreaseQuantity(){this.medicine.quantity>0&&this.quantityDecreased.emit(this.medicine.id)}increaseQuantity(){this.quantityIncreased.emit(this.medicine.id)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=x({type:i,selectors:[["app-resumen-medicina"]],inputs:{medicine:"medicine"},outputs:{medicineDeleted:"medicineDeleted",quantityIncreased:"quantityIncreased",quantityDecreased:"quantityDecreased"},standalone:!0,features:[M],decls:14,vars:3,consts:[[1,"medicine-card"],[1,"medicine-content"],[1,"medicine-header"],[1,"medicine-name"],["type","button",1,"delete-button",3,"click"],[1,"medicine-quantity-controls"],["type","button",1,"decrease-button",3,"click","disabled"],[1,"medicine-quantity"],["type","button",1,"increase-button",3,"click"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),f(4),s(),c(5,"button",4),l("click",function(){return n.deleteMedicine()}),f(6," \xD7 "),s()(),c(7,"div",5)(8,"button",6),l("click",function(){return n.decreaseQuantity()}),f(9," - "),s(),c(10,"p",7),f(11),s(),c(12,"button",8),l("click",function(){return n.increaseQuantity()}),f(13," + "),s()()()()),t&2&&(m(4),O(n.medicine.name),m(4),d("disabled",n.medicine.quantity<=0),m(3),O(n.medicine.quantity))},styles:[".medicine-card[_ngcontent-%COMP%]{box-shadow:0 2px 4px #0000001a;padding:16px;background-color:#fff;border-top:1px solid #e5e7eb;margin-bottom:8px;min-width:355px}.medicine-content[_ngcontent-%COMP%]{margin-top:16px}.medicine-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.medicine-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;padding:15px}.delete-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:red;font-size:1.5rem}.medicine-quantity-controls[_ngcontent-%COMP%]{display:flex;gap:20px;padding:2px 20px;background-color:#f3f4f6;border-radius:8px}.decrease-button[_ngcontent-%COMP%], .increase-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.5rem}.medicine-quantity[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700}"]})}}return i})();var J=(i,v)=>({patientName:i,patientId:v});function K(i,v){i&1&&(c(0,"p",6),f(1," El Tratamiento est\xE1 vac\xEDo "),s())}function W(i,v){if(i&1){let e=T();D(0),c(1,"app-resumen-medicina",10),l("medicineDeleted",function(n){g(e);let a=_(2);return h(a.onMedicineDeleted(n))})("quantityIncreased",function(n){g(e);let a=_(2);return h(a.onQuantityIncreased(n))})("quantityDecreased",function(n){g(e);let a=_(2);return h(a.onQuantityDecreased(n))}),s(),k()}if(i&2){let e=v.$implicit;m(),d("medicine",e)}}function X(i,v){if(i&1){let e=T();c(0,"div",7)(1,"app-resumen-paciente",8),l("deletePatient",function(){g(e);let n=_();return h(n.deletePatient())}),s(),S(2,W,2,1,"ng-container",9),s()}if(i&2){let e=_();m(),d("paciente",R(2,J,e.treatment.patientName,e.treatment.patient_id)),m(),d("ngForOf",e.treatment.medications)}}function Y(i,v){if(i&1){let e=T();c(0,"div",11)(1,"input",12),l("change",function(n){g(e);let a=_();return h(a.onObservationChange(n))}),s(),c(2,"button",13),l("click",function(){g(e);let n=_();return h(n.saveTreatment())}),s()()}i&2&&(m(2),d("textContent","Confirmar tratamiento"))}var he=(()=>{class i{constructor(e,t,n){this.treatmentService=e,this.toastrService=t,this.router=n,this.treatment={}}ngOnInit(){this.treatmentService.getTreatment().subscribe(e=>{this.treatment=e})}onMedicineDeleted(e){this.treatmentService.removeMedication(e)}onQuantityIncreased(e){this.treatmentService.increaseMedicationQuantity(e)}onQuantityDecreased(e){this.treatmentService.decreaseMedicationQuantity(e)}onObservationChange(e){let t=e.target;t&&t.value&&this.treatmentService.updateObservation(t.value)}deletePatient(){this.treatmentService.updatePatient(0,"")}saveTreatment(){this.treatmentService.saveTreatment().subscribe(e=>{e.success===!1?(this.toastrService.error("El tratamiento tiene errores","Alerta"),e.messages.forEach(t=>{this.toastrService.error(t,"Alerta")})):(console.log("Tratamiento guardado correctamente:",e),this.toastrService.success("El tratamiento se guard\xF3 correctamente","\xC9xito"),this.router.navigate(["/dashboardMedicinas"]))},e=>{this.toastrService.error("Ocurri\xF3 un error inesperado","Alerta"),console.error("Error inesperado:",e)})}static{this.\u0275fac=function(t){return new(t||i)(C(H),C(L),C(N))}}static{this.\u0275cmp=x({type:i,selectors:[["app-resumen-tratamiento"]],standalone:!0,features:[M],decls:7,vars:3,consts:[[1,"sidebar"],[1,"title"],[1,"treatment-container"],["class","empty-message",4,"ngIf"],["class","treatment-details",4,"ngIf"],["class","treatment-form",4,"ngIf"],[1,"empty-message"],[1,"treatment-details"],[3,"deletePatient","paciente"],[4,"ngFor","ngForOf"],[3,"medicineDeleted","quantityIncreased","quantityDecreased","medicine"],[1,"treatment-form"],["type","text","placeholder","Observaciones","name","name",1,"name-input",3,"change"],["value","Confirmar Tratamiento",1,"submit-button",3,"click","textContent"]],template:function(t,n){t&1&&(c(0,"aside",0)(1,"h1",1),f(2,"Crear Tratamiento"),s(),c(3,"div",2),S(4,K,2,0,"p",3)(5,X,3,5,"div",4)(6,Y,3,1,"div",5),s()()),t&2&&(m(4),d("ngIf",!n.treatment.patient_id&&n.treatment.medications.length===0),m(),d("ngIf",n.treatment.patient_id||n.treatment.medications.length>0),m(),d("ngIf",n.treatment.patient_id&&n.treatment.medications&&n.treatment.medications.length>0))},dependencies:[B,j,V,Q,U],styles:[".sidebar[_ngcontent-%COMP%]{height:100vh;overflow-y:auto;padding:20px;width:400px;max-width:500px;background-color:#fff;position:sticky}.title[_ngcontent-%COMP%]{font-size:2rem;text-align:center;font-weight:700}.empty-message[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.treatment-details[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center;gap:10px;flex-direction:column}.treatment-details-item[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:20px;color:#fff;margin-bottom:5px;background-color:#1e90ff}.treatment-form[_ngcontent-%COMP%]{width:100%;margin-top:80px;display:flex;flex-direction:column;gap:10px}.name-input[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ccc;padding:10px;width:100%;border:2px solid dodgerblue}.submit-button[_ngcontent-%COMP%]{padding:20px 10px;border-radius:5px;border:none;text-transform:uppercase;color:#fff;background-color:#1e90ff;width:100%;text-align:center;cursor:pointer;font-weight:700;margin-top:40px}"]})}}return i})();export{H as a,he as b};

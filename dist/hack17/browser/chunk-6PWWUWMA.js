import{a as b,b as w}from"./chunk-YHSLCSDN.js";import"./chunk-HBVGJIFA.js";import"./chunk-DMAP7O3B.js";import"./chunk-SEBF2BU2.js";import"./chunk-226KYS73.js";import"./chunk-36MGJEOV.js";import"./chunk-P4DBDHMG.js";import{a as E}from"./chunk-6BZURQTQ.js";import"./chunk-R7DZLFCY.js";import{C as l,D as d}from"./chunk-7LRRDA6O.js";import{$ as h,Mb as C,Na as u,Oa as f,Wa as _,a as m,b as p,fb as L,jb as a,kb as s,lb as g,tb as r}from"./chunk-LJKVXSQR.js";var $=(()=>{class n{constructor(o){this.ngZone=o,this.lotes=[],this.filteredLotes=[],this.columnas=["medication_id","expiration_date","quantity"],this.encabezados=["Medicamento","Fecha de Caducidad","Cantidad"]}ngOnInit(){this.getLotes()}getLotes(){let{headers:o}=d();fetch(`${l.apiUrl}medication_expiration/getAll`,{method:"GET",headers:o}).then(t=>t.json()).then(t=>{console.log("Datos recibidos:",t),this.ngZone.run(()=>{this.lotes=t.data.MedicationExpirationDate.slice(0,20).map(e=>p(m({},e),{expiration_date:new Date(e.expiration_date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})})),this.filteredLotes=this.lotes})})}deleteLote(o){let{headers:t}=d();fetch(`${l.apiUrl}medication_expiration/delete/${o.id}`,{method:"DELETE",headers:t}).then(e=>{if(e.ok)return e.json();throw new Error(`Error ${e.status}: ${e.statusText}`)}).then(e=>{console.log(e),this.ngZone.run(()=>{this.getLotes()})}).catch(e=>{console.error(e),this.ngZone.run(()=>{alert("Error al eliminar el lote")})})}filterLotes(o){console.log(this.filteredLotes),this.filteredLotes=this.lotes.filter(t=>t.medication.name.toLowerCase().includes(o.toLowerCase()))}cleanSearch(){this.filteredLotes=this.lotes}static{this.\u0275fac=function(t){return new(t||n)(f(_))}}static{this.\u0275cmp=h({type:n,selectors:[["app-gestion-lotes"]],standalone:!0,features:[C],decls:4,vars:5,consts:[["title","Lotes de Medicamentos"],[1,"horizontal"],["placeholder","Buscar por Medicamento",3,"search","clean"],[3,"delete","items","columns","columnHeaders","showEdit","showDelete"]],template:function(t,e){t&1&&(g(0,"app-h1",0),a(1,"div",1)(2,"app-searchbar",2),r("search",function(i){return e.filterLotes(i)})("clean",function(){return e.cleanSearch()}),s()(),a(3,"app-table2",3),r("delete",function(i){return e.deleteLote(i)}),s()),t&2&&(u(3),L("items",e.filteredLotes)("columns",e.columnas)("columnHeaders",e.encabezados)("showEdit",!1)("showDelete",!1))},dependencies:[E,w,b]})}}return n})();export{$ as default};

import{a as Y}from"./chunk-FU2ESGJ5.js";import{a as ee}from"./chunk-U7IQAVNE.js";import"./chunk-HBVGJIFA.js";import"./chunk-TFB6PPQ3.js";import"./chunk-BOAM24EX.js";import"./chunk-P4DBDHMG.js";import{a as X,b as g}from"./chunk-FYQRXYID.js";import{a as K}from"./chunk-QH7CS6OP.js";import"./chunk-NMGI7OHJ.js";import{c as J}from"./chunk-R7DZLFCY.js";import{C as P,D as q,i as B,j as E,m as Z,n as M,q as G,r as V}from"./chunk-7LRRDA6O.js";import{$ as D,Eb as s,Fb as I,Gb as F,Mb as x,Na as d,Oa as b,Q as z,Qb as W,Rb as A,Tb as N,V as Q,Vb as U,a as p,b as u,db as w,fb as l,ia as h,ja as y,jb as c,k as R,kb as r,lb as L,mb as $,n as j,nb as H,pb as S,ra as v,tb as m,ub as _}from"./chunk-LJKVXSQR.js";var te=(()=>{class o{constructor(){this.donante=null,this.deleteCharity=new v}delete(){this.deleteCharity.emit(this.donante?.charityId)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=D({type:o,selectors:[["app-resumen-donante"]],inputs:{donante:"donante"},outputs:{deleteCharity:"deleteCharity"},standalone:!0,features:[x],decls:8,vars:2,consts:[[1,"patient-detail"],[1,"patient-data"],["type","button",1,"delete-button",3,"click"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"p"),s(3),r(),c(4,"p"),s(5),r()(),c(6,"button",2),m("click",function(){return n.delete()}),s(7," \xD7 "),r()()),t&2&&(d(3),F("RIF: ",n.donante==null?null:n.donante.razon_social,""),d(2),F("Descripcion: ",n.donante==null?null:n.donante.charityName,""))},styles:[".patient-detail[_ngcontent-%COMP%]{min-width:335px;display:flex;justify-content:space-between;flex-direction:row;margin-left:10px}.patient-data[_ngcontent-%COMP%]{font-weight:600}.delete-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:red;font-size:1.5rem}"]})}}return o})();var ie=(()=>{class o{constructor(){this.medicine={name:"",id:0,expiration_date:"",quantity:1},this.medicineDeleted=new v,this.quantityIncreased=new v,this.quantityDecreased=new v,this.dateChanged=new v}deleteMedicine(){this.medicineDeleted.emit(this.medicine?.id)}decreaseQuantity(){this.medicine.quantity>0&&this.quantityDecreased.emit(this.medicine.id)}increaseQuantity(){this.quantityIncreased.emit(this.medicine.id)}changeDate(e){let t=e.target,n=new Date(t.value),i=new Date;i.setHours(0,0,0,0),n.setHours(0,0,0,0),i>n?(t.value=i.toISOString().split("T")[0],this.medicine.expiration_date=t.value):this.medicine.expiration_date=t.value,this.dateChanged.emit({id:this.medicine.id,newDate:n>=i?n.toISOString():i.toISOString()}),console.log(this.medicine.expiration_date)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=D({type:o,selectors:[["app-card-medicamento-with-date"]],inputs:{medicine:"medicine"},outputs:{medicineDeleted:"medicineDeleted",quantityIncreased:"quantityIncreased",quantityDecreased:"quantityDecreased",dateChanged:"dateChanged"},standalone:!0,features:[x],decls:19,vars:7,consts:[[1,"medicine-card"],[1,"medicine-content"],[1,"medicine-header"],[1,"medicine-name"],["type","button",1,"delete-button",3,"click"],[1,"medicine-quantity-controls"],["type","button",1,"decrease-button",3,"click","disabled"],[1,"medicine-quantity"],["type","button",1,"increase-button",3,"click"],[1,"medicine-expiredate"],["type","date",3,"change","value"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),s(4),r(),c(5,"button",4),m("click",function(){return n.deleteMedicine()}),s(6," \xD7 "),r()(),c(7,"div",5)(8,"button",6),m("click",function(){return n.decreaseQuantity()}),s(9," - "),r(),c(10,"p",7),s(11),r(),c(12,"button",8),m("click",function(){return n.increaseQuantity()}),s(13," + "),r()(),c(14,"div",9)(15,"p"),s(16,"Fecha de Vencimiento"),r(),c(17,"input",10),N(18,"date"),m("change",function(a){return n.changeDate(a)}),r()()()()),t&2&&(d(4),I(n.medicine.name),d(4),l("disabled",n.medicine.quantity===0),d(3),I(n.medicine.quantity),d(6),l("value",n.medicine.expiration_date?U(18,4,n.medicine.expiration_date,"yyyy-MM-dd"):""))},dependencies:[M,Z],styles:[".medicine-card[_ngcontent-%COMP%]{box-shadow:0 2px 4px #0000001a;padding:16px;background-color:#fff;border-top:1px solid #e5e7eb;margin-bottom:8px;min-width:355px}.medicine-content[_ngcontent-%COMP%]{margin-top:16px}.medicine-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.medicine-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;padding:15px}.delete-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:red;font-size:1.5rem}.medicine-quantity-controls[_ngcontent-%COMP%]{display:flex;gap:20px;padding:2px 20px;background-color:#f3f4f6;border-radius:8px}.decrease-button[_ngcontent-%COMP%], .increase-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.5rem}.medicine-quantity[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700}.medicine-expiredate[_ngcontent-%COMP%]{margin-top:20px}.medicine-expiredate[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid dodgerblue;padding:5px;border-radius:20px;font-weight:700}"]})}}return o})();var k=(()=>{class o{constructor(e){this.http=e,this.apiURL=`${P.apiUrl}donation/`,this.dateSchema=g.string().refine(t=>{if(!t)return!1;let n=new Date;return new Date(t)>=n},{message:"La fecha es obligatoria y no puede ser anterior a la fecha actual."}),this.medicationSchema=g.object({medication_id:g.number().int().positive().or(g.literal(0)).refine(t=>t!==0,{message:"El ID del medicamento es requerido y debe ser un n\xFAmero positivo."}),quantity:g.number().int().nonnegative().refine(t=>t>0,{message:"La cantidad debe ser un n\xFAmero positivo."}),expiration_date:this.dateSchema}),this.donationSchema=g.object({description:g.string().min(1,{message:"La descripci\xF3n es requerida."}),category_id:g.number().int().positive().or(g.literal(0)).refine(t=>t!==0,{message:"La Categoria es Obligatoria"}),charity_id:g.number().int().positive().or(g.literal(0)).refine(t=>t!==0,{message:"Debe seleccionar un Donador"}),medications:g.array(this.medicationSchema).nonempty({message:"Se requiere al menos un medicamento."})}),this.donation=new R({description:"",category_id:0,category_name:"",razon_social:"",charity_id:0,charity_name:"",medications:[]}),this.data=this.donation.asObservable()}updateDonation(e){this.donation.next(e)}updateCharity(e,t,n){let i=this.donation.getValue(),a=u(p({},i),{charity_id:e,charity_name:t,razon_social:n});this.updateDonation(a)}removeCharity(){let e=this.donation.getValue(),t=u(p({},e),{charity_id:0,charity_name:""});this.updateDonation(t)}updateDescription(e){let t=this.donation.getValue(),n=u(p({},t),{description:e});this.updateDonation(n)}addMedication(e,t,n){let i=this.donation.getValue(),a=i.medications?.findIndex(O=>O.medication_id===e),C;if(a!==-1){let O=i.medications[a];O.quantity+=n,C=[...i.medications.slice(0,a),O,...i.medications.slice(a+1)]}else C=[...i.medications,{medication_id:e,name:t,quantity:n}];let re=u(p({},i),{medications:C});this.updateDonation(re)}removeMedication(e){let t=this.donation.getValue(),n=t.medications.filter(a=>a.medication_id!==e),i=u(p({},t),{medications:n});this.updateDonation(i)}increaseMedicationQuantity(e){let t=this.donation.getValue(),n=t.medications.map(a=>a.medication_id===e?u(p({},a),{quantity:a.quantity+1}):a),i=u(p({},t),{medications:n});this.updateDonation(i)}decreaseMedicationQuantity(e){let t=this.donation.getValue(),n=t.medications.map(a=>a.medication_id===e?u(p({},a),{quantity:Math.max(a.quantity-1,0)}):a),i=u(p({},t),{medications:n});this.updateDonation(i)}updateMedicationExpireDate(e,t){let n=this.donation.getValue(),i=n.medications.map(C=>+C.medication_id===e?u(p({},C),{expiration_date:t}):C),a=u(p({},n),{medications:i});this.updateDonation(a),console.log(this.donation.getValue())}updateCategory(e){let t=this.donation.getValue(),n=u(p({},t),{category_id:e});console.log(this.donation.getValue()),this.updateDonation(n)}getDonation(){return this.data}validateDonation(e){try{return this.donationSchema.parse(e),{success:!0}}catch(t){return t instanceof X?(console.error("Error de validaci\xF3n:",t.errors),{success:!1,messages:t.errors.map(i=>i.message)}):(console.error("Error inesperado:",t),{success:!1,messages:["Ocurri\xF3 un error inesperado"]})}}saveDonation(){let e=this.donation.getValue(),t=this.validateDonation(e);if(!t.success)return j({success:!1,messages:t.messages});let n=new G({"Content-Type":"application/json"}),{headerPost:i}=q(),a={description:e.description,category_id:e.category_id,charity_id:e.charity_id,medications:e.medications.map(C=>({medication_id:C.medication_id,quantity:C.quantity,expiration_date:C.expiration_date}))};return this.http.post(`${this.apiURL}create`,a,{headers:n})}static{this.\u0275fac=function(t){return new(t||o)(Q(V))}}static{this.\u0275prov=z({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var de=(o,f,e)=>({charityId:o,charityName:f,razon_social:e}),se=(o,f,e,t)=>({name:o,id:f,quantity:e,expiration_date:t});function me(o,f){o&1&&(c(0,"p",10),s(1," La donacion est\xE1 vac\xEDa "),r())}function le(o,f){if(o&1&&(c(0,"option",11),s(1),r()),o&2){let e=f.$implicit;l("value",e.id),d(),I(e.name)}}function pe(o,f){if(o&1){let e=S();$(0),c(1,"app-card-medicamento-with-date",15),m("medicineDeleted",function(){let n=h(e).$implicit,i=_(2);return y(i.onMedicineDeleted(n.medication_id))})("quantityIncreased",function(){let n=h(e).$implicit,i=_(2);return y(i.onQuantityIncreased(n.medication_id))})("quantityDecreased",function(){let n=h(e).$implicit,i=_(2);return y(i.onQuantityDecreased(n.medication_id))})("dateChanged",function(n){let i=h(e).$implicit,a=_(2);return y(a.onDateChanged(i.medication_id,n.newDate))}),r(),H()}if(o&2){let e=f.$implicit;d(),l("medicine",A(1,se,e.name||"Sin nombre",e.medication_id||0,e.quantity||0,e.expiration_date?e.expiration_date:""))}}function ue(o,f){if(o&1){let e=S();c(0,"div",12)(1,"app-resumen-donante",13),m("deleteCharity",function(){h(e);let n=_();return y(n.deleteCharity())}),r(),w(2,pe,2,6,"ng-container",14),r()}if(o&2){let e=_();d(),l("donante",W(2,de,e.donation==null?null:e.donation.charity_id,e.donation==null?null:e.donation.charity_name,e.donation==null?null:e.donation.razon_social)),d(),l("ngForOf",e.donation==null?null:e.donation.medications)}}function _e(o,f){if(o&1){let e=S();c(0,"div",16)(1,"input",17,0),m("change",function(n){h(e);let i=_();return y(i.onDesacriptionChange(n))}),r(),c(3,"button",18),m("click",function(){h(e);let n=_();return y(n.saveDonation())}),s(4,"Confirmar Donacion"),r()()}}var ae=(()=>{class o{constructor(e,t,n,i){this.donationService=e,this.notificationService=t,this.http=n,this.router=i,this.donation=null,this.donationSubscription=null,this.categories=[]}ngOnInit(){this.donationSubscription=this.donationService.getDonation().subscribe(e=>{this.donation=e}),this.loadCategories()}loadCategories(){let{headers:e}=q();this.http.get(`${P.apiUrl}category/getAllActive`,{headers:e}).subscribe(t=>{console.log(t),this.categories=t.data.Category},t=>{console.error("Error al cargar las categor\xEDas:",t)})}ngOnDestroy(){this.donationSubscription&&this.donationSubscription.unsubscribe()}onMedicineDeleted(e){this.notificationService.warning("Eliminado","Alerta"),this.donationService.removeMedication(e)}onQuantityIncreased(e){this.donationService.increaseMedicationQuantity(e)}onQuantityDecreased(e){this.donationService.decreaseMedicationQuantity(e)}onDateChanged(e,t){this.donationService.updateMedicationExpireDate(e,t)}onCategorySelected(e){let n=e.target.value;this.donationService.updateCategory(+n)}onDesacriptionChange(e){let t=e.target;t&&t.value&&this.donationService.updateDescription(t.value)}deleteCharity(){this.donationService.updateCharity(0,"","")}saveDonation(){this.donationService.saveDonation().subscribe(e=>{e.success===!1?(this.notificationService.error("La Donaci\xF3n tiene errores","Alerta"),e.messages?.forEach(t=>{this.notificationService.error(t,"Alerta")})):(console.log("Donaci\xF3n guardada correctamente:",e),this.notificationService.success("La Donaci\xF3n se guard\xF3 correctamente","\xC9xito"),this.router.navigate(["/dashboardMedicinas"]))},e=>{console.log("Error recibido:",e),this.notificationService.error("Ocurri\xF3 un error inesperado","Alerta")})}static{this.\u0275fac=function(t){return new(t||o)(b(k),b(K),b(V),b(J))}}static{this.\u0275cmp=D({type:o,selectors:[["app-resumen-donacion"]],standalone:!0,features:[x],decls:11,vars:4,consts:[["descriptionInput",""],[1,"sidebar"],[1,"title"],[1,"treatment-container"],["class","empty-message",4,"ngIf"],["name","category","id","category-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","treatment-details",4,"ngIf"],["class","treatment-form",4,"ngIf"],[1,"empty-message"],[3,"value"],[1,"treatment-details"],[3,"deleteCharity","donante"],[4,"ngFor","ngForOf"],[3,"medicineDeleted","quantityIncreased","quantityDecreased","dateChanged","medicine"],[1,"treatment-form"],["type","text","placeholder","Descripci\xF3n","name","name",1,"name-input",3,"change"],[1,"submit-button",3,"click"]],template:function(t,n){t&1&&(c(0,"aside",1)(1,"h1",2),s(2,"Crear Donacion"),r(),c(3,"div",3),w(4,me,2,0,"p",4),c(5,"select",5),m("change",function(a){return n.onCategorySelected(a)}),c(6,"option",6),s(7,"Seleccione una Categor\xEDa"),r(),w(8,le,2,2,"option",7),r(),w(9,ue,3,6,"div",8)(10,_e,5,0,"div",9),r()()),t&2&&(d(4),l("ngIf",!(n.donation!=null&&n.donation.charity_id)&&!(n.donation!=null&&n.donation.medications)),d(4),l("ngForOf",n.categories),d(),l("ngIf",(n.donation==null?null:n.donation.charity_id)||(n.donation==null||n.donation.medications==null?null:n.donation.medications.length)),d(),l("ngIf",(n.donation==null?null:n.donation.charity_id)&&(n.donation==null?null:n.donation.medications)&&(n.donation==null||n.donation.medications==null?null:n.donation.medications.length)))},dependencies:[M,B,E,te,ie],styles:[".sidebar[_ngcontent-%COMP%]{height:100vh;overflow-y:auto;padding:20px;width:400px;max-width:500px;background-color:#fff;position:sticky}.title[_ngcontent-%COMP%]{font-size:2rem;text-align:center;font-weight:700}.empty-message[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.treatment-details[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center;gap:10px;flex-direction:column}.treatment-details-item[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:20px;color:#fff;margin-bottom:5px;background-color:#1e90ff}.treatment-form[_ngcontent-%COMP%]{width:100%;margin-top:80px;display:flex;flex-direction:column;gap:10px}.name-input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ccc;padding:10px;width:100%;border:2px solid dodgerblue}.submit-button[_ngcontent-%COMP%]{padding:20px 10px;border-radius:5px;border:none;text-transform:uppercase;color:#fff;background-color:#1e90ff;width:100%;text-align:center;cursor:pointer;font-weight:700;margin-top:40px}"]})}}return o})();function ge(o,f){if(o&1){let e=S();c(0,"app-lista-donante",3),m("donanteSeleccionado",function(n){h(e);let i=_();return y(i.onDonanteSeleccionado(n))}),r()}}function fe(o,f){if(o&1){let e=S();c(0,"app-lista-medicinas",4),m("medicinaSeleccionada",function(n){h(e);let i=_();return y(i.onMedicinaSeleccionada(n))})("deletePatient",function(){h(e);let n=_();return y(n.onDeleteDonante())}),r()}}var Xe=(()=>{class o{constructor(e){this.donationService=e,this.donation=null}ngOnInit(){this.donationService.getDonation().subscribe(e=>{this.donation=e})}onDonanteSeleccionado(e){this.donationService.updateCharity(e.id,e.description,e.razon_social)}onDeleteDonante(){this.donationService.removeCharity()}onMedicinaSeleccionada(e){this.donationService.addMedication(e.id,e.name,1)}static{this.\u0275fac=function(t){return new(t||o)(b(k))}}static{this.\u0275cmp=D({type:o,selectors:[["app-form-donacion"]],standalone:!0,features:[x],decls:4,vars:2,consts:[[1,"cont"],[3,"donanteSeleccionado",4,"ngIf"],[3,"medicinaSeleccionada","deletePatient",4,"ngIf"],[3,"donanteSeleccionado"],[3,"medicinaSeleccionada","deletePatient"]],template:function(t,n){t&1&&(c(0,"div",0),w(1,ge,1,0,"app-lista-donante",1)(2,fe,1,0,"app-lista-medicinas",2),L(3,"app-resumen-donacion"),r()),t&2&&(d(),l("ngIf",!(n.donation!=null&&n.donation.charity_id)),d(),l("ngIf",n.donation==null?null:n.donation.charity_id))},dependencies:[Y,ee,ae,M,E],styles:[".cont[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:80px}.wrapper[_ngcontent-%COMP%]{padding:10px;display:flex;align-items:center;gap:40px;flex-direction:column}.cards-cont[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(150px,1fr));gap:65px;align-items:start;overflow-y:scroll;padding:15px;height:auto}.card[_ngcontent-%COMP%]{background-color:#1e90ff;color:#fff;padding:10px 20px;min-width:290px;max-width:290px;cursor:pointer;box-shadow:0 4px 20px #00000062;border-radius:20px;text-align:center;display:flex;align-items:start;justify-content:start;flex-direction:column}@media (min-width: 1500px){.cont[_ngcontent-%COMP%]{gap:100px}}"]})}}return o})();export{Xe as default};

import{a as X}from"./chunk-3V5ZJTXH.js";import"./chunk-U7IQAVNE.js";import"./chunk-HBVGJIFA.js";import{a as K}from"./chunk-BOAM24EX.js";import"./chunk-P4DBDHMG.js";import{a as J,b as f}from"./chunk-FYQRXYID.js";import{a as Z}from"./chunk-QH7CS6OP.js";import"./chunk-NMGI7OHJ.js";import{c as B}from"./chunk-R7DZLFCY.js";import{C as I,D as G,i as P,j as T,n as S,q as W,r as q}from"./chunk-7LRRDA6O.js";import{$ as y,Eb as c,Fb as E,Hb as O,Mb as v,Na as d,Oa as b,Pb as H,Q,Rb as U,V as L,a as h,b as M,db as x,fb as s,ha as z,ia as g,ja as _,jb as o,k as R,kb as r,lb as A,mb as $,n as j,nb as N,pb as C,ra as w,tb as m,ub as l}from"./chunk-LJKVXSQR.js";function ae(i,p){if(i&1&&(o(0,"li"),c(1),r()),i&2){let e=p.$implicit;d(),O(" ",e.name,", Cantidad: ",e.quantity," ")}}var Y=(()=>{class i{constructor(){this.treatment=null}translateStatus(e){switch(e){case"not supplied":return"No suministrado";case"partially supplied":return"Parcialmente suministrado";case"supplied":return"Suministrado";default:return"Estado desconocido"}}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["app-card-tratamiento"]],inputs:{treatment:"treatment"},standalone:!0,features:[v],decls:15,vars:4,consts:[[1,"patient-card"],[1,"patient-card-header"],[1,"id-card"],[1,"patient-card-body"],[1,"contact-info"],[1,"pathologies"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),c(3),r(),o(4,"p",2),c(5),r()(),o(6,"div",3)(7,"div",4)(8,"p"),c(9),r()(),o(10,"div",5)(11,"h3"),c(12,"Medicamentos:"),r(),o(13,"ul"),x(14,ae,2,2,"li",6),r()()()()),t&2&&(d(3),E(n.treatment==null?null:n.treatment.id),d(2),E(n.translateStatus(n.treatment==null?null:n.treatment.status)),d(4),E(n.treatment==null?null:n.treatment.observation),d(5),s("ngForOf",n.treatment==null?null:n.treatment.medications))},dependencies:[S,P],styles:[".patient-card[_ngcontent-%COMP%]{max-width:300px;min-height:320px;max-height:320px;margin:20px auto;background-color:#fff;border-radius:8px;overflow-y:auto;box-shadow:0 4px 6px #0000001a;transition:all .3s ease;cursor:pointer}.patient-card[_ngcontent-%COMP%]:hover{transform:scale(1.02);box-shadow:0 8px 12px #00000026}.patient-card-header[_ngcontent-%COMP%]{background-color:#1e90ff;padding:15px;color:#fff}.patient-card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.2em;font-weight:700}.patient-card-header[_ngcontent-%COMP%]   .id-card[_ngcontent-%COMP%]{margin:5px 0 0;font-size:.9em;opacity:.9}.patient-card-body[_ngcontent-%COMP%]{padding:15px}.contact-info[_ngcontent-%COMP%]{margin-bottom:15px;font-size:.9em;color:#333}.contact-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;display:flex;align-items:center}.contact-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px;color:#1e90ff}.pathologies[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1em;color:#1e90ff;margin:0 0 10px}.pathologies[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0;font-size:.8em}.pathologies[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:#f0f8ff;border-radius:4px;padding:5px 8px;margin-bottom:5px;display:inline-block;margin-right:5px}"]})}}return i})();function oe(i,p){if(i&1){let e=C();o(0,"app-card-tratamiento",5),m("click",function(){let n=g(e).$implicit,a=l();return _(a.seleccionarTratamiento(n))}),r()}if(i&2){let e=p.$implicit;s("treatment",e)}}var ee=(()=>{class i{constructor(e){this.http=e,this.idPaciente=null,this.id=null,this.treatments=null,this.filteredTreatments=[],this.tratamientoSeleccionado=new w,this.deletePatient=new w,this.loadTreatments()}delete(){this.deletePatient.emit()}loadTreatments(){let{headers:e}=G();this.http.get(`${I.apiUrl}treatment/getAll`,{headers:e}).subscribe(t=>{this.treatments=t.data.Treatment,console.log(this.treatments),this.filterTreatments()})}seleccionarTratamiento(e){this.tratamientoSeleccionado.emit(e)}ngOnChanges(){this.filterTreatments()}filterTreatments(){if(this.idPaciente!==null)this.filteredTreatments=this.treatments.filter(e=>e.patient_id===this.idPaciente),console.log(this.filterTreatments);else return}static{this.\u0275fac=function(t){return new(t||i)(b(q))}}static{this.\u0275cmp=y({type:i,selectors:[["app-lista-tratamiento"]],inputs:{idPaciente:"idPaciente",id:"id"},outputs:{tratamientoSeleccionado:"tratamientoSeleccionado",deletePatient:"deletePatient"},standalone:!0,features:[z,v],decls:8,vars:1,consts:[[1,"wrapper"],[1,"header-cont"],[1,"gobackbutton",3,"click"],[1,"cards-cont"],[3,"treatment","click",4,"ngFor","ngForOf"],[3,"click","treatment"]],template:function(t,n){t&1&&(o(0,"main",0)(1,"div",1)(2,"h2"),c(3,"Selecciona un Tratamiento"),r()(),o(4,"button",2),m("click",function(){return n.delete()}),c(5,"Volver"),r(),o(6,"div",3),x(7,oe,1,1,"app-card-tratamiento",4),r()()),t&2&&(d(7),s("ngForOf",n.filteredTreatments))},dependencies:[Y,S,P],styles:[".wrapper[_ngcontent-%COMP%]{padding:5px;display:flex;align-items:center;gap:40px;flex-direction:column;max-height:95vh}.header-cont[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column}.cards-cont[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(150px,1fr));gap:55px;overflow-y:scroll;padding:15px;max-height:90vh}.gobackbutton[_ngcontent-%COMP%]{margin-left:5px;background-color:#1e90ff;color:#fff;cursor:pointer;border:2px solid dodgerblue;border-radius:10px;padding:10px;box-shadow:0 4px 20px #0000001a}@media (min-width: 1300px){.card[_ngcontent-%COMP%]{min-width:290px;max-width:290px}}"]})}}return i})();var te=(()=>{class i{constructor(){this.medicine={name:"",id:0,quantity:0,maxQuantity:0},this.medicineDeleted=new w,this.quantityIncreased=new w,this.quantityDecreased=new w}deleteMedicine(){this.medicineDeleted.emit(this.medicine.id)}decreaseQuantity(){this.medicine.quantity>0&&(this.medicine.quantity--,this.quantityDecreased.emit(this.medicine.id))}increaseQuantity(){this.medicine.quantity<this.medicine.maxQuantity&&(this.medicine.quantity++,this.quantityIncreased.emit(this.medicine.id))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=y({type:i,selectors:[["app-card-medicamento-entrega"]],inputs:{medicine:"medicine"},outputs:{medicineDeleted:"medicineDeleted",quantityIncreased:"quantityIncreased",quantityDecreased:"quantityDecreased"},standalone:!0,features:[v],decls:14,vars:5,consts:[[1,"medicine-card"],[1,"medicine-content"],[1,"medicine-header"],[1,"medicine-name"],["type","button",1,"delete-button",3,"click"],[1,"medicine-quantity-controls"],["type","button",1,"decrease-button",3,"click","disabled"],[1,"medicine-quantity"],["type","button",1,"increase-button",3,"click","disabled"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"p",3),c(4),r(),o(5,"button",4),m("click",function(){return n.deleteMedicine()}),c(6," \xD7 "),r()(),o(7,"div",5)(8,"button",6),m("click",function(){return n.decreaseQuantity()}),c(9," - "),r(),o(10,"p",7),c(11),r(),o(12,"button",8),m("click",function(){return n.increaseQuantity()}),c(13," + "),r()()()()),t&2&&(d(4),E(n.medicine.name),d(4),s("disabled",n.medicine.quantity<=0),d(3),O("",n.medicine.quantity," / ",n.medicine.maxQuantity,""),d(),s("disabled",n.medicine.quantity>=n.medicine.maxQuantity))},styles:[".medicine-card[_ngcontent-%COMP%]{box-shadow:0 2px 4px #0000001a;padding:16px;background-color:#fff;border-top:1px solid #e5e7eb;margin-bottom:8px;min-width:355px}.medicine-content[_ngcontent-%COMP%]{margin-top:16px}.medicine-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.medicine-name[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;padding:15px}.delete-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:red;font-size:1.5rem}.medicine-quantity-controls[_ngcontent-%COMP%]{display:flex;gap:20px;padding:2px 20px;background-color:#f3f4f6;border-radius:8px}.decrease-button[_ngcontent-%COMP%], .increase-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.5rem}.medicine-quantity[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:700}"]})}}return i})();var V=(()=>{class i{constructor(e){this.http=e,this.medicationSchema=f.object({id:f.number().int().optional(),name:f.string().min(1,{message:"El nombre del medicamento es obligatorio."}),delivery_details:f.object({quantity:f.number().int().nonnegative().refine(t=>t>0,{message:"La cantidad debe ser un n\xFAmero positivo."})})}),this.deliverySchema=f.object({patient_id:f.number().int().positive().or(f.literal(0)).refine(t=>t!==0,{message:"El paciente es obligatorio"}),treatment_id:f.number().int().positive().or(f.literal(0)).refine(t=>t!==0,{message:"El tratamiento es obligatorio "}),appointment_date:f.string().min(1,{message:"La fecha de la cita es obligatoria."}),expiration_date:f.string().min(1,{message:"La fecha de vencimiento es obligatoria."}),medications:f.array(this.medicationSchema).nonempty({message:"Debe haber al menos un medicamento."})}),this.delivery=new R({patient_id:0,patientidCard:0,treatment_id:0,appointment_date:"",withdrawal_date:null,expiration_date:"",medications:[]}),this.apiURL=`${I.apiUrl}delivery/`}getDelivery(){return this.delivery.asObservable()}setDelivery(e){this.delivery.next(e)}updateDelivery(e){let t=this.delivery.getValue();this.delivery.next(h(h({},t),e))}updatePatient(e,t,n){let a=this.delivery.getValue();this.delivery.next(M(h({},a),{patient_id:e,patientidCard:t,patient_name:n}))}addMedicationsFromTreatment(e){console.log(e);let n=[...e.medications?e.medications.map(a=>({id:a.id,name:a.name,delivery_details:{quantity:0,max_quantity:a.quantity}})):[]];this.updateDelivery({medications:n})}removeMedication(e){let n=this.delivery.getValue().medications.filter(a=>a.delivery_details.quantity!==e);this.updateDelivery({medications:n})}increaseMedicationQuantity(e,t=1){let a=this.delivery.getValue().medications.map(u=>u.id===e?M(h({},u),{delivery_details:{quantity:u.delivery_details.quantity+t,max_quantity:u.delivery_details.max_quantity}}):u);this.updateDelivery({medications:a}),console.log(this.delivery.getValue())}decreaseMedicationQuantity(e,t=1){let a=this.delivery.getValue().medications.map(u=>{if(u.id===e){let k=u.delivery_details.quantity-t;return M(h({},u),{delivery_details:{quantity:k>0?k:0,max_quantity:u.delivery_details.max_quantity}})}return u});this.updateDelivery({medications:a})}updateExpirationDate(e){let t=this.delivery.getValue();this.delivery.next(M(h({},t),{expiration_date:e}))}onApoinmentDateChange(e){let t=this.delivery.getValue();this.delivery.next(M(h({},t),{appointment_date:e}))}onWithdrawalDateChange(e){let t=this.delivery.getValue();this.delivery.next(M(h({},t),{withdrawal_date:e}))}validateDelivery(e){try{return this.deliverySchema.parse(e),{success:!0}}catch(t){return t instanceof J?(console.error("Error de validaci\xF3n:",t.errors),{success:!1,messages:t.errors.map(a=>a.message)}):(console.error("Error inesperado:",t),{success:!1,messages:["Ocurri\xF3 un error inesperado"]})}}saveDelivery(){let e=this.delivery.getValue(),t=this.validateDelivery(e);if(!t.success)return j({success:!1,messages:t.messages});let n=new W({"Content-Type":"application/json"}),a={patient_id:e.patient_id,treatment_id:e.treatment_id,appointment_date:e.appointment_date,withdrawal_date:null,expiration_date:e.expiration_date,medications:e.medications.map(u=>({medication_id:u.id,quantity:u.delivery_details.quantity}))};return this.http.post(`${this.apiURL}create`,a,{headers:n})}static{this.\u0275fac=function(t){return new(t||i)(L(q))}}static{this.\u0275prov=Q({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var de=(i,p)=>({patientName:i,patientId:p}),se=(i,p,e,t)=>({name:i,id:p,quantity:e,maxQuantity:t});function ce(i,p){i&1&&(o(0,"p",6),c(1," La Entrega est\xE1 vac\xEDa "),r())}function le(i,p){if(i&1){let e=C();$(0),o(1,"app-card-medicamento-entrega",10),m("medicineDeleted",function(n){g(e);let a=l(2);return _(a.onMedicineDeleted(+n))})("quantityIncreased",function(n){g(e);let a=l(2);return _(a.onQuantityIncreased(+n))})("quantityDecreased",function(n){g(e);let a=l(2);return _(a.onQuantityDecreased(+n))}),r(),N()}if(i&2){let e=p.$implicit;d(),s("medicine",U(1,se,e?e.name:"Sin nombre",e?e.id:0,e.delivery_details.quantity,e.delivery_details.max_quantity))}}function me(i,p){if(i&1){let e=C();o(0,"div",7)(1,"app-resumen-paciente",8),m("deletePatient",function(){g(e);let n=l();return _(n.deletePatient())}),r(),x(2,le,2,6,"ng-container",9),r()}if(i&2){let e=l();d(),s("paciente",H(2,de,e.delivery==null?null:e.delivery.patient_name,e.delivery.patient_id.toString())),d(),s("ngForOf",e.delivery.medications)}}function pe(i,p){if(i&1){let e=C();o(0,"div",11)(1,"p"),c(2,"Fecha para vencimiento de entrega"),r(),o(3,"input",12),m("change",function(n){g(e);let a=l();return _(a.onExpireDateChange(n))}),r(),o(4,"p"),c(5,"Fecha para Cita de entrega"),r(),o(6,"input",13),m("change",function(n){g(e);let a=l();return _(a.onApoinmentDateChange(n))}),r(),o(7,"button",14),m("click",function(){g(e);let n=l();return _(n.saveDelivery())}),c(8,"Confirmar Entrega"),r()()}if(i&2){let e=l();d(3),s("value",e.delivery==null?null:e.delivery.expiration_date),d(3),s("value",e.delivery==null?null:e.delivery.appointment_date)}}var ie=(()=>{class i{constructor(e,t,n){this.deliveryService=e,this.toastService=t,this.router=n,this.delivery=null}ngOnInit(){this.deliveryService.getDelivery().subscribe(e=>{this.delivery=e})}onMedicineDeleted(e){this.deliveryService.removeMedication(e)}onQuantityIncreased(e){this.deliveryService.increaseMedicationQuantity(e)}onQuantityDecreased(e){this.deliveryService.decreaseMedicationQuantity(e)}onExpireDateChange(e){let t=e.target;t&&t.value&&this.deliveryService.updateExpirationDate(t.value),console.log(this.delivery)}onWithdrawalDateChange(e){let t=e.target;t&&t.value&&this.deliveryService.onWithdrawalDateChange(t.value),console.log(this.delivery)}onApoinmentDateChange(e){let t=e.target;t&&t.value&&this.deliveryService.onApoinmentDateChange(t.value),console.log(this.delivery)}deletePatient(){this.deliveryService.updatePatient(0,0,""),this.toastService.success("Eliminado","Alerta")}saveDelivery(){this.deliveryService.saveDelivery().subscribe(e=>{e.success===!1?(this.toastService.error("La entrega tiene errores","Alerta"),e.messages.forEach(t=>{this.toastService.error(t,"Alerta")})):(console.log("Delivery saved successfully:",e),this.toastService.success("La entrega se guard\xF3 correctamente","\xC9xito"),this.router.navigate(["/gestionEntrega"]))},e=>{this.toastService.error("Ocurri\xF3 un error inesperado","Alerta"),console.error("Error inesperado:",e)})}static{this.\u0275fac=function(t){return new(t||i)(b(V),b(Z),b(B))}}static{this.\u0275cmp=y({type:i,selectors:[["app-resumen-entrega"]],standalone:!0,features:[v],decls:7,vars:3,consts:[[1,"sidebar"],[1,"title"],[1,"treatment-container"],["class","empty-message",4,"ngIf"],["class","treatment-details",4,"ngIf"],["class","treatment-form",4,"ngIf"],[1,"empty-message"],[1,"treatment-details"],[3,"deletePatient","paciente"],[4,"ngFor","ngForOf"],[3,"medicineDeleted","quantityIncreased","quantityDecreased","medicine"],[1,"treatment-form"],["type","date","placeholder","Fecha Vencimiento consulta","name","name",1,"name-input",3,"change","value"],["type","date","placeholder","Fecha Cita consulta","name","name",1,"name-input",3,"change","value"],["type","submit","value","Confirmar Tratamiento",1,"submit-button",3,"click"]],template:function(t,n){t&1&&(o(0,"aside",0)(1,"h1",1),c(2,"Generar Entrega"),r(),o(3,"div",2),x(4,ce,2,0,"p",3)(5,me,3,5,"div",4)(6,pe,9,2,"div",5),r()()),t&2&&(d(4),s("ngIf",!(n.delivery!=null&&n.delivery.patient_id)&&(n.delivery==null?null:n.delivery.medications)),d(),s("ngIf",(n.delivery==null?null:n.delivery.patient_id)||(n.delivery==null||n.delivery.medications==null?null:n.delivery.medications.length)),d(),s("ngIf",n.delivery.patient_id&&n.delivery.medications&&n.delivery.medications.length>0))},dependencies:[S,P,T,K,te],styles:[".sidebar[_ngcontent-%COMP%]{height:100vh;overflow-y:auto;padding:20px;width:400px;max-width:500px;background-color:#fff;position:sticky}.title[_ngcontent-%COMP%]{font-size:2rem;text-align:center;font-weight:700}.empty-message[_ngcontent-%COMP%]{text-align:center;margin:20px 0}.treatment-details[_ngcontent-%COMP%]{margin-top:20px;display:flex;justify-content:center;gap:10px;flex-direction:column}.treatment-details-item[_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:20px;color:#fff;margin-bottom:5px;background-color:#1e90ff}.treatment-form[_ngcontent-%COMP%]{width:100%;margin-top:80px;display:flex;flex-direction:column;gap:10px}.name-input[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ccc;padding:10px;width:100%;border:2px solid dodgerblue}.submit-button[_ngcontent-%COMP%]{padding:20px 10px;border-radius:5px;border:none;text-transform:uppercase;color:#fff;background-color:#1e90ff;width:100%;text-align:center;cursor:pointer;font-weight:700;margin-top:40px}"]})}}return i})();function ue(i,p){if(i&1){let e=C();o(0,"app-lista-pacientes",3),m("pacienteSeleccionado",function(n){g(e);let a=l();return _(a.onPacienteSeleccionado(n))}),r()}}function ge(i,p){if(i&1){let e=C();o(0,"app-lista-tratamiento",4),m("tratamientoSeleccionado",function(n){g(e);let a=l();return _(a.onTratamientoSeleccionado(n))})("deletePatient",function(){g(e);let n=l();return _(n.onDeletePaciente())}),r()}if(i&2){let e=l();s("idPaciente",e.delivery.patient_id)("id",e.delivery.patientidCard)}}var Ge=(()=>{class i{constructor(e){this.deliveryService=e,this.delivery=null}ngOnInit(){this.deliveryService.getDelivery().subscribe(e=>{this.delivery=e})}onPacienteSeleccionado(e){this.deliveryService.updatePatient(+e.id,+e.id_card,`${e.first_name} ${e.last_name}`)}onDeletePaciente(){this.deliveryService.updatePatient(0,0,"")}onTratamientoSeleccionado(e){this.deliveryService.updateDelivery({treatment_id:e.id}),this.deliveryService.addMedicationsFromTreatment(e)}static{this.\u0275fac=function(t){return new(t||i)(b(V))}}static{this.\u0275cmp=y({type:i,selectors:[["app-form-entrega"]],standalone:!0,features:[v],decls:4,vars:2,consts:[[1,"cont"],[3,"pacienteSeleccionado",4,"ngIf"],[3,"idPaciente","id","tratamientoSeleccionado","deletePatient",4,"ngIf"],[3,"pacienteSeleccionado"],[3,"tratamientoSeleccionado","deletePatient","idPaciente","id"]],template:function(t,n){t&1&&(o(0,"div",0),x(1,ue,1,0,"app-lista-pacientes",1)(2,ge,1,2,"app-lista-tratamiento",2),A(3,"app-resumen-entrega"),r()),t&2&&(d(),s("ngIf",!(n.delivery!=null&&n.delivery.patient_id)),d(),s("ngIf",n.delivery==null?null:n.delivery.patient_id))},dependencies:[ee,X,S,T,ie],styles:[".cont[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:20px}.wrapper[_ngcontent-%COMP%]{padding:10px;display:flex;align-items:center;gap:40px;flex-direction:column}.cards-cont[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(150px,1fr));gap:65px;align-items:start;overflow-y:scroll;padding:15px;height:auto}.card[_ngcontent-%COMP%]{background-color:#1e90ff;color:#fff;padding:10px 20px;min-width:290px;max-width:290px;cursor:pointer;box-shadow:0 4px 20px #00000062;border-radius:20px;text-align:center;display:flex;align-items:start;justify-content:start;flex-direction:column}@media (min-width: 1500px){.cont[_ngcontent-%COMP%]{gap:80px}}"]})}}return i})();export{Ge as default};

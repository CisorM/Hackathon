import{a as y,b as C}from"./chunk-YHSLCSDN.js";import"./chunk-HBVGJIFA.js";import"./chunk-DMAP7O3B.js";import{a as w}from"./chunk-SEBF2BU2.js";import"./chunk-226KYS73.js";import"./chunk-36MGJEOV.js";import"./chunk-P4DBDHMG.js";import{a as v}from"./chunk-6BZURQTQ.js";import{c as E}from"./chunk-R7DZLFCY.js";import{C as r,D as s}from"./chunk-7LRRDA6O.js";import{$ as g,Mb as f,Na as d,Oa as l,Wa as u,fb as p,jb as c,kb as m,lb as h,tb as _}from"./chunk-LJKVXSQR.js";var U=(()=>{class i{verEntrega(n){this.router.navigate([`gestionEntrega/${n.id}`])}entregado(n){let{headers:t}=s();fetch(`${r.apiUrl}delivery/changeDelivered/${n.id}`,{method:"PUT",headers:t,body:JSON.stringify({status:"delivered"})}).then(e=>{if(console.log(e),e.ok)return e.json();throw new Error(`Error ${e.status}: ${e.statusText}`)}).then(e=>{console.log(e),this.entregas=this.entregas.filter(a=>a.id!==n.id)}).catch(e=>{console.error(e)})}expirado(n){let{headers:t}=s();fetch(`${r.apiUrl}delivery/changeExpired/${n.id}`,{method:"PUT",headers:t,body:JSON.stringify({status:"expired"})}).then(e=>{if(console.log(e),e.ok)return e.json();throw new Error(`Error ${e.status}: ${e.statusText}`)}).then(e=>{console.log(e),this.entregas=this.entregas.filter(a=>a.id!==n.id),this.router.navigate(["/gestion-expirado"])}).catch(e=>{console.error(e)})}constructor(n,t){this.ngZone=n,this.router=t,this.entregas=[],this.columnas=["appointment_date","patient_name","patient_id_card","expiration_date","status"],this.encabezados=["Fecha de Entrega","Nombre del Paciente","Cedula","Fecha de Expiraci\xF3n","Estado"]}ngOnInit(){this.getEntregas()}getEntregas(){let{headers:n}=s();fetch(`${r.apiUrl}delivery/getPending`,{method:"GET",headers:n}).then(t=>t.json()).then(t=>{console.log("Datos recibidos:",t),this.ngZone.run(()=>{this.entregas=t.data.Delivery.map(e=>({id:e.id,appointment_date:new Date(e.appointment_date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),withdrawal_date:new Date(e.withdrawal_date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),treatment_id:e.treatment_id,patient_id:e.patient_id,patient_name:e.patient?e.patient.first_name:"",patient_id_card:e.patient?e.patient.id_card:"",expiration_date:new Date(e.expiration_date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),status:e.status}))})})}static{this.\u0275fac=function(t){return new(t||i)(l(u),l(E))}}static{this.\u0275cmp=g({type:i,selectors:[["app-gestion-entrega"]],standalone:!0,features:[f],decls:5,vars:12,consts:[["title","Gestion Entrega"],[1,"horizontal"],[3,"label","route"],[3,"view","entregado","expirado","items","columns","columnHeaders","showEdit","showDelete","showView","showEntregado","showProcesado","showExpirado","showCancelado"]],template:function(t,e){t&1&&(h(0,"app-h1",0),c(1,"div",1),h(2,"app-btn",2)(3,"app-searchbar"),m(),c(4,"app-table2",3),_("view",function(o){return e.verEntrega(o)})("entregado",function(o){return e.entregado(o)})("expirado",function(o){return e.expirado(o)}),m()),t&2&&(d(2),p("label","Crear Entrega")("route","/crearEntrega"),d(2),p("items",e.entregas)("columns",e.columnas)("columnHeaders",e.encabezados)("showEdit",!1)("showDelete",!1)("showView",!0)("showEntregado",!0)("showProcesado",!1)("showExpirado",!1)("showCancelado",!1))},dependencies:[v,C,y,w],styles:[".horizontal[_ngcontent-%COMP%]{display:flex}"]})}}return i})();export{U as default};
